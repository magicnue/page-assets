<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title id="page-title-tag">Hexo Theme Redefine 示例</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --background-color: #fff;
            --second-background-color: #f8f8f8;
            --third-background-color: #f2f2f2;
            --primary-color: #0066cc;
            --default-text-color: #333;
            --second-text-color: #555;
            --third-text-color: #777;
            --fourth-text-color: #999;
            --border-color: #eee;
            --shadow-color-1: rgba(0, 0, 0, 0.08);
            --scrollbar-color: #c1c1c1;
            --scrollbar-color-hover: #a1a1a1;
            --scroll-bar-bg-color: #fafafa;
            --redefine-box-shadow: 0 6px 24px rgba(0, 0, 0, 0.05);
            --redefine-box-shadow-flat: 0 1px 3px rgba(0, 0, 0, 0.08);
            --redefine-border-radius-large: 16px;
            --redefine-border-radius-medium: 12px;
            --redefine-border-radius-small: 8px;
            --navbar-height: 60px;

            --light-wallpaper-url: url('https://image.magicnue.top/assets/wallpaper_250425-1.png');
            --dark-wallpaper-url: url('https://image.magicnue.top/assets/wallpaper_250425-2.png');
            --current-wallpaper-url: var(--light-wallpaper-url);
        }

        * {
            transition: all 0.2s ease;
        }

        html, body {
            position: relative;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            color: var(--default-text-color);
            background-color: var(--background-color);
            background-image: var(--current-wallpaper-url);
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            font-family: 'Geist', 'Noto Sans SC', sans-serif;
            font-weight: 400;
            font-size: 16px;
            line-height: 1.5;
        }

        a {
            text-decoration: none;
            color: var(--default-text-color);
            position: relative;
            outline: 0;
            cursor: pointer;
            overflow-wrap: break-word;
            box-sizing: border-box;
            padding-bottom: 2px;
            text-underline-offset: 2px;
            text-decoration-color: var(--fourth-text-color);
            transition: text-decoration-color 0.2s ease;
        }

        a:hover, a:active {
            text-decoration: none !important;
            color: var(--primary-color);
        }

        a:hover i, a:hover span, a:active i, a:active span {
            color: var(--primary-color);
        }

        .page-container {
            width: 100%;
            min-height: 100vh;
        }

        .main-content-container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100vh;
        }

        .main-content-header {
            background-color: var(--background-color);
            box-shadow: var(--redefine-box-shadow-flat);
            height: var(--navbar-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .navbar-logo {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .navbar-menu {
            display: flex;
            gap: 20px;
        }

        .navbar-menu-item {
            font-size: 1rem;
        }

        .main-content-body {
            flex: 1;
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .main-content {
            flex: 1;
        }
        
        .home-article-item {
            position: relative;
            background-color: var(--background-color);
            border-radius: var(--redefine-border-radius-medium);
            box-shadow: var(--redefine-box-shadow-flat);
            padding: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .home-article-item:hover {
            transform: scale(1.015);
            box-shadow: var(--redefine-box-shadow);
        }

        .home-article-title {
            position: relative;
            font-weight: 600;
            font-size: 1.4rem;
            line-height: 1.5;
            color: var(--second-text-color);
            margin: 0 0 10px 0;
        }

        .main-content-footer {
            background-color: var(--second-background-color);
            padding: 20px;
            text-align: center;
            color: var(--third-text-color);
        }

        .right-side-tools-container {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .side-tool-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--background-color);
            box-shadow: var(--redefine-box-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--second-text-color);
        }

        .side-tool-button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .repo-title-redefine {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--second-text-color);
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: var(--background-color);
            border-radius: var(--redefine-border-radius-medium);
            box-shadow: var(--redefine-box-shadow-flat);
        }

        .breadcrumb-redefine {
            margin-bottom: 20px;
            font-size: 1rem;
            padding: 12px 20px;
            background-color: var(--second-background-color);
            border-radius: var(--redefine-border-radius-small);
            color: var(--third-text-color);
            box-shadow: var(--redefine-box-shadow-flat);
        }
        .breadcrumb-redefine a {
            color: var(--primary-color);
            text-decoration: none;
            padding-bottom: 0;
        }
        .breadcrumb-redefine a:hover {
            text-decoration: underline !important;
        }
        .breadcrumb-redefine span:not(:last-child) { /* Style current folder name differently */
             margin: 0 5px;
        }
         .breadcrumb-redefine span.current-folder-crumb {
            color: var(--default-text-color);
            font-weight: 500;
        }


        .loading-redefine,
        .message-redefine {
            padding: 20px;
            margin-bottom: 20px;
            background-color: var(--background-color);
            border-radius: var(--redefine-border-radius-medium);
            text-align: center;
            color: var(--default-text-color);
            box-shadow: var(--redefine-box-shadow-flat);
        }
        .message-redefine.error-panel {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid var(--border-color);
        }
        .message-redefine.empty-panel {
             background-color: var(--second-background-color);
        }

        .file-list-redefine {
            display: flex;
            flex-direction: column;
            gap: 20px;
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .file-browser-item .home-article-title { /* Applied to item-name span */
            margin-bottom: 0; /* Remove bottom margin if it's from home-article-title */
            font-size: 1.2rem; /* Adjust size for file/folder names */
        }

        .file-item-content-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .item-icon-container {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background-color: var(--primary-color); /* Default for folders */
        }
        
        .item-icon-container.file-icon-bg {
            background-color: var(--third-text-color); 
        }
        .item-icon-container .material-icons {
            color: white !important; /* Ensure icon color is white and overrides general a:hover i */
            font-size: 22px;
        }

        .item-details {
            flex-grow: 1;
            overflow: hidden;
        }
        .item-name { 
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            color: var(--second-text-color);
            padding-bottom: 0; /* Override general 'a' padding */
        }
        .item-name:hover {
            color: var(--primary-color);
        }

        .item-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .action-button {
            padding: 6px 12px;
            border-radius: var(--redefine-border-radius-small);
            background-color: var(--primary-color);
            color: white !important;
            text-decoration: none !important;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            box-shadow: var(--redefine-box-shadow-flat);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .action-button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
            color: white !important;
        }
        .action-button .material-icons {
            font-size: 16px;
            color: white !important; 
        }
        .action-button:hover .material-icons {
             color: white !important;
        }


        @media (max-width: 991px) {
            .home-article-title {
                font-size: 1.3rem;
            }
            .repo-title-redefine {
                font-size: 1.6rem;
            }
             .file-browser-item .home-article-title {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 768px) {
            .home-article-title {
                font-size: 1.2rem;
            }
            .navbar-menu {
                display: none; 
            }
            .file-item-content-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .item-actions {
                margin-top: 10px;
                width: 100%;
            }
            .action-button {
                flex-grow: 1;
                justify-content: center;
            }
             .repo-title-redefine {
                font-size: 1.4rem;
            }
             .file-browser-item .home-article-title {
                font-size: 1rem;
            }
        }
         @media (max-width: 480px) {
            .item-actions {
                flex-direction: column;
                gap: 8px;
            }
            .action-button {
                 width: 100%;
                 padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <main class="page-container">
        <div class="main-content-container">
            <div class="main-content-header">
                <div class="navbar">
                    <div class="navbar-logo" id="repo-brand-logo">File Browser</div>
                    <div class="navbar-menu">
                        <a id="github-repo-link-styled" href="#" target="_blank" class="navbar-menu-item">首页</a>
                        <a id="github-repo-link-styled" href="#" target="_blank" class="navbar-menu-item">GitHub 仓库</a>
                    </div>
                </div>
            </div>

            <div class="main-content-body">
                <div class="main-content">
                    <h1 id="page-main-title" class="repo-title-redefine">File List</h1>
                    <div id="breadcrumb-container" class="breadcrumb-redefine">
                    </div>

                    <div id="loading" class="loading-redefine" style="text-align: center; padding: 20px;">
                        <p>Loading...</p>
                    </div>

                    <ul id="file-list" class="file-list-redefine" style="display:none;">
                    </ul>
                    <div id="empty-folder-message" class="message-redefine empty-panel" style="display:none;">
                        This folder is empty.
                    </div>
                    <div id="error-message" class="message-redefine error-panel" style="display:none;">
                        Error: Could not load file list.
                    </div>
                </div>
            </div>

            <div class="main-content-footer">
                <div>© <span id="current-year">2025</span> <span id="footer-repo-name"></span> File Browser</div>
                <div>Powered by GitHub API & Redefine Style</div>
            </div>
        </div>

        <div class="right-side-tools-container">
            <div class="side-tool-button" id="back-to-top" style="opacity:0;">
                <i>↑</i>
            </div>
            <div class="side-tool-button" id="toggle-dark-mode">
                <i>☀</i>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const backToTopButton = document.getElementById('back-to-top');
            backToTopButton.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            window.addEventListener('scroll', function() {
                if (window.scrollY > 300) {
                    backToTopButton.style.opacity = '1';
                } else {
                    backToTopButton.style.opacity = '0';
                }
            });

            const darkModeToggle = document.getElementById('toggle-dark-mode');
            const htmlElement = document.documentElement;
              
            darkModeToggle.addEventListener('click', function() {
                if (htmlElement.style.getPropertyValue('--background-color') === '#222') {
                    htmlElement.style.setProperty('--background-color', '#fff');
                    htmlElement.style.setProperty('--second-background-color', '#f8f8f8');
                    htmlElement.style.setProperty('--third-background-color', '#f2f2f2');
                    htmlElement.style.setProperty('--default-text-color', '#333');
                    htmlElement.style.setProperty('--second-text-color', '#555');
                    htmlElement.style.setProperty('--third-text-color', '#777');
                    htmlElement.style.setProperty('--fourth-text-color', '#999');
                    htmlElement.style.setProperty('--border-color', '#eee');
                    htmlElement.style.setProperty('--current-wallpaper-url', "var(--light-wallpaper-url)");
                    darkModeToggle.innerHTML = '<i>☀</i>';
                } else {
                    htmlElement.style.setProperty('--background-color', '#222');
                    htmlElement.style.setProperty('--second-background-color', '#333');
                    htmlElement.style.setProperty('--third-background-color', '#444');
                    htmlElement.style.setProperty('--default-text-color', '#eee');
                    htmlElement.style.setProperty('--second-text-color', '#ddd');
                    htmlElement.style.setProperty('--third-text-color', '#bbb');
                    htmlElement.style.setProperty('--fourth-text-color', '#999');
                    htmlElement.style.setProperty('--border-color', '#555');
                    htmlElement.style.setProperty('--current-wallpaper-url', "var(--dark-wallpaper-url)");
                    darkModeToggle.innerHTML = '<i>☾</i>';
                }
            });

            const REPO_OWNER = 'magicnue'; 
            const REPO_NAME = 'page-assets';   
            const ROOT_FOLDER = 'src'; 

            const GITHUB_API_BASE_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/`;
            
            const fileListEl = document.getElementById('file-list');
            const loadingEl = document.getElementById('loading');
            const errorMessageEl = document.getElementById('error-message');
            const emptyFolderMessageEl = document.getElementById('empty-folder-message');
            const breadcrumbContainerEl = document.getElementById('breadcrumb-container');
            const pageMainTitleEl = document.getElementById('page-main-title');
            const repoBrandLogoEl = document.getElementById('repo-brand-logo');
            const pageTitleTagEl = document.getElementById('page-title-tag');
            const githubRepoLinkStyledEl = document.getElementById('github-repo-link-styled');
            const footerRepoNameEl = document.getElementById('footer-repo-name');


            document.getElementById('current-year').textContent = new Date().getFullYear();
            if (REPO_OWNER && REPO_NAME && REPO_OWNER !== 'YOUR_GITHUB_USERNAME' && REPO_NAME !== 'YOUR_REPOSITORY_NAME') {
                if(repoBrandLogoEl) repoBrandLogoEl.textContent = REPO_NAME;
                if(githubRepoLinkStyledEl) githubRepoLinkStyledEl.href = `https://github.com/${REPO_OWNER}/${REPO_NAME}`;
                if(pageTitleTagEl) pageTitleTagEl.textContent = `${REPO_NAME} - File Browser`;
                if(pageMainTitleEl) pageMainTitleEl.textContent = `目录: /${ROOT_FOLDER}`;
                if(footerRepoNameEl) footerRepoNameEl.textContent = REPO_NAME;
            } else {
                if(pageMainTitleEl) pageMainTitleEl.textContent = "Configuration Required";
                errorMessageEl.innerHTML = '<strong>Please configure REPO_OWNER and REPO_NAME in the script.</strong>';
                errorMessageEl.style.display = 'block';
                loadingEl.style.display = 'none';
                return; 
            }

            async function fetchFiles(path = '') {
                showLoading(true);
                fileListEl.style.display = 'none';
                emptyFolderMessageEl.style.display = 'none';
                errorMessageEl.style.display = 'none';
                fileListEl.innerHTML = ''; 

                const apiPath = path ? path : ROOT_FOLDER;
                const apiUrl = GITHUB_API_BASE_URL + apiPath;

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    updateBreadcrumbs(apiPath);
                    const displayPathForTitle = apiPath;
                    if(pageMainTitleEl) pageMainTitleEl.textContent = `目录: /${displayPathForTitle}`;
                    if(pageTitleTagEl) pageTitleTagEl.textContent = `${REPO_NAME} - /${displayPathForTitle}`;


                    if (!Array.isArray(data)) {
                        throw new Error("Invalid data format from API.");
                    }

                    if (data.length === 0) {
                        emptyFolderMessageEl.style.display = 'block';
                    } else {
                        fileListEl.style.display = 'flex';
                        const directories = data.filter(item => item.type === 'dir').sort((a, b) => a.name.localeCompare(b.name));
                        const files = data.filter(item => item.type === 'file').sort((a, b) => a.name.localeCompare(b.name));
                        
                        [...directories, ...files].forEach(item => {
                            createListItem(item);
                        });
                    }

                } catch (error) {
                    console.error('Error fetching files:', error);
                    errorMessageEl.textContent = `Error: Could not load file list (${error.message}). Path: ${apiPath}.`;
                    errorMessageEl.style.display = 'block';
                } finally {
                    showLoading(false);
                }
            }

            function showLoading(isLoading) {
                loadingEl.style.display = isLoading ? 'block' : 'none';
            }

            function getFileIcon(fileName) {
                const extension = fileName.split('.').pop().toLowerCase();
                switch (extension) {
                    case 'pdf': return 'picture_as_pdf';
                    case 'doc': case 'docx': return 'description';
                    case 'xls': case 'xlsx': return 'grid_on';
                    case 'ppt': case 'pptx': return 'slideshow';
                    case 'zip': case 'rar': case 'tar': case 'gz': return 'archive';
                    case 'txt': return 'text_fields';
                    case 'jpg': case 'jpeg': case 'png': case 'gif': case 'bmp': case 'svg': return 'image';
                    case 'mp3': case 'wav': case 'ogg': return 'audiotrack';
                    case 'mp4': case 'mov': case 'avi': case 'wmv': return 'movie';
                    case 'js': case 'json': case 'html': case 'css': case 'py': case 'java': case 'c': case 'cpp': return 'code';
                    default: return 'insert_drive_file';
                }
            }

            function createListItem(item) {
                const listItem = document.createElement('li');
                listItem.className = 'file-browser-item home-article-item'; 

                const itemContentWrapper = document.createElement('div');
                itemContentWrapper.className = 'file-item-content-wrapper';

                const iconContainer = document.createElement('div');
                iconContainer.className = 'item-icon-container';
                const icon = document.createElement('i');
                icon.className = 'material-icons item-icon';
                icon.textContent = item.type === 'dir' ? 'folder' : getFileIcon(item.name);
                if (item.type !== 'dir') {
                    iconContainer.classList.add('file-icon-bg');
                }
                iconContainer.appendChild(icon);

                const itemDetails = document.createElement('div');
                itemDetails.className = 'item-details';
                const titleSpan = document.createElement('span');
                titleSpan.className = 'item-name home-article-title'; 
                titleSpan.textContent = item.name;
                itemDetails.appendChild(titleSpan);

                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';

                const filePageUrl = item.download_url || item.html_url; // Use download_url for files, html_url as fallback or for dirs if needed for direct repo view

                if (item.type === 'dir') {
                    titleSpan.onclick = () => fetchFiles(item.path);
                    const openBtn = document.createElement('a');
                    openBtn.className = 'action-button';
                    openBtn.innerHTML = `<i class="material-icons">folder_open</i> Open`;
                    openBtn.onclick = (e) => { e.preventDefault(); fetchFiles(item.path); };
                    actionsDiv.appendChild(openBtn);
                } else if (item.type === 'file') {
                    titleSpan.onclick = () => window.open(filePageUrl, '_blank');
                    
                    const viewBtn = document.createElement('a');
                    viewBtn.href = filePageUrl;
                    viewBtn.target = '_blank';
                    viewBtn.className = 'action-button';
                    viewBtn.innerHTML = `<i class="material-icons">visibility</i> View`;
                    actionsDiv.appendChild(viewBtn);

                    const downloadBtn = document.createElement('a');
                    downloadBtn.href = filePageUrl; 
                    downloadBtn.setAttribute('download', item.name);
                    downloadBtn.className = 'action-button';
                    downloadBtn.innerHTML = `<i class="material-icons">file_download</i> Download`;
                    actionsDiv.appendChild(downloadBtn);
                }

                itemContentWrapper.appendChild(iconContainer);
                itemContentWrapper.appendChild(itemDetails);
                itemContentWrapper.appendChild(actionsDiv);
                listItem.appendChild(itemContentWrapper);
                fileListEl.appendChild(listItem);
            }

            function updateBreadcrumbs(currentPath) {
                breadcrumbContainerEl.innerHTML = ''; 
                
                let displayPath = currentPath;
                let rootCrumbPath = ROOT_FOLDER;

                if (currentPath.startsWith(ROOT_FOLDER + '/')) {
                    displayPath = currentPath.substring(ROOT_FOLDER.length + 1);
                } else if (currentPath === ROOT_FOLDER) {
                    displayPath = ''; 
                } else { // Path is outside ROOT_FOLDER (e.g. repo root), adjust rootCrumbPath
                    rootCrumbPath = ''; // Indicates we are at repo root if path doesn't contain ROOT_FOLDER
                }


                const rootLink = document.createElement('a');
                rootLink.href = '#!';
                rootLink.textContent = ROOT_FOLDER || 'Root'; // Display 'Root' if ROOT_FOLDER is empty
                rootLink.onclick = (e) => {
                    e.preventDefault();
                    fetchFiles(ROOT_FOLDER);
                };
                breadcrumbContainerEl.appendChild(rootLink);

                if (displayPath) {
                    const parts = displayPath.split('/');
                    let pathAccumulator = ROOT_FOLDER;
                    parts.forEach((part, index) => {
                        if (part === "") return; // Skip empty parts if any (e.g. from trailing slash)
                        pathAccumulator += (pathAccumulator ? '/' : '') + part;
                        
                        const separator = document.createElement('span');
                        separator.textContent = ' / ';
                        breadcrumbContainerEl.appendChild(separator);

                        if (index === parts.length - 1) { 
                            const currentFolderSpan = document.createElement('span');
                            currentFolderSpan.textContent = part;
                            currentFolderSpan.className = 'current-folder-crumb';
                            breadcrumbContainerEl.appendChild(currentFolderSpan);
                        } else {
                            const partLink = document.createElement('a');
                            partLink.href = '#!';
                            partLink.textContent = part;
                            const capturedPath = pathAccumulator; 
                            partLink.onclick = (e) => {
                                e.preventDefault();
                                fetchFiles(capturedPath);
                            };
                            breadcrumbContainerEl.appendChild(partLink);
                        }
                    });
                } else if (currentPath === ROOT_FOLDER) {
                     // This case means we are AT the root folder, it's already handled by the rootLink.
                     // If you want to explicitly show the ROOT_FOLDER as current, add:
                    const separator = document.createElement('span');
                    separator.textContent = ' / ';
                    // breadcrumbContainerEl.appendChild(separator); // Only if ROOT_FOLDER is not the first segment displayed
                    const currentFolderSpan = document.createElement('span');
                    currentFolderSpan.textContent = ROOT_FOLDER.split('/').pop() || 'Current';
                    currentFolderSpan.className = 'current-folder-crumb';
                    // breadcrumbContainerEl.appendChild(currentFolderSpan); // Not ideal if rootLink already says ROOT_FOLDER
                }
            }
            fetchFiles(ROOT_FOLDER);
        });
    </script>
</body>
</html>